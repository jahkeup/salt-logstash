{% from 'logstash/map.jinja' import logstash with context %}

input {
  file {
    type => "syslog"
    path => ["/var/log/secure",
             "/var/log/messages",
             "/var/log/syslog",
             "/var/log/auth.log",
             "/var/log/kern.log",
             "/var/log/dmesg"]
    exclude => ["*.gz", "shipper.log"]
  }
  file {
    type => "salt"
    path => ["/var/log/salt/minion","/var/log/salt/master"]
    exclude => ["*.gz"]
  }
}

filter {
  grok {
    type => "salt"
    patterns_dir => "{{logstash.patterns}}"
    pattern => "%{SALTLOGBASE}"
    add_tag => ["salt-log", "grokked"]
  }
  date {
    type => "salt"
    match => [ "timestamp", "yyyy-MM-dd HH:mm:ss,SSS" ]
    add_tag => [ "dated" ]
  }
}

output {
  stdout { } # print out to the /var/log/<service_log>
  redis {
    host => "{{logstash.redis_host}}"
    data_type => "list"
    key => "logstash"
  }
}

